<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Butterfly Image Upload by User</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }

        .container {
            width: 80%;
            margin: 50px auto;
            background: #fff;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        h1 {
            color: #333;
        }

        input[type="file"] {
            margin: 20px 0;
        }

        button {
            padding: 10px 20px;
            background-color: #007BFF;
            color: #fff;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }

        button:hover {
            background-color: #0056b3;
        }

        .table-wrapper {
            margin-top: 20px;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            font-size: x-small;
        }

        th {
            background-color: #f2f2f2;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        tr:hover {
            background-color: #f1f1f1;
        }
    </style>
</head>

<body>

    <div class="container">
        <h1>Upload Image</h1>
        <input type="file" id="imageUpload" accept="image/*">
        <button onclick="processImage()">Upload</button>
        <div id="output"></div>
        <!-- <button onclick="addLocation()">Add Location</button>
        <button onclick="postData()">Post</button> -->
    </div>

    <div class="container">
        <h1>Butterfly Image Upload by User</h1>
        <!-- <button onclick="uploadImage()">Post</button> -->
        <div class="table-wrapper">
            <form action="" id="uploadForm">
                <table>
                    <thead>
                        <tr>
                            <th>Uploader Name</th>
                            <th>Upload Reference ID</th>
                            <th>Common Name</th>
                            <th>Percent %</th>
                            <th>Upload Image</th>
                            <th>Size</th>
                            <th>Mime Type</th>
                            <th>Last Modified</th>
                            <th>Content</th>
                            <th>Date</th>
                            <th>Actions</th>
                            
                        </tr>
                    </thead>
                    <tbody id="imageTableBody">
                        <!-- Rows will be added here by JavaScript -->
                    </tbody>
                </table>
            </form>
            
        </div>
    </div>

    <script>
        function processImage() {
            const predOutput = [
                'Butterfly-Clippers', 'Butterfly-Common Jay', 'Butterfly-Common Lime',
                'Butterfly-Common Mime', 'Butterfly-Common Mormon', 'Butterfly-Emerald Swallowtail',
                'Butterfly-Golden Birdwing', 'Butterfly-Gray Glassy Tiger', 'Butterfly-Great Eggfly',
                'Butterfly-Great Yellow Mormon', 'Butterfly-Paper Kite', 'Butterfly-Plain Tiger',
                'Butterfly-Red Lacewing', 'Butterfly-Scarlet Mormon', 'Butterfly-Pink Rose',
                'Butterfly-Tailed Jay', 'Moth-Giant Silk', 'Moth-Atlas'
            ];

            const imgInput = document.getElementById('imageUpload');
            const outputDiv = document.getElementById('output');
            outputDiv.innerHTML = '';

            if (imgInput.files && imgInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const imgElement = document.createElement('img');
                    imgElement.src = e.target.result;
                    imgElement.style.width = '150px';
                    outputDiv.appendChild(imgElement);

                    const itm = Math.floor(Math.random() * predOutput.length);
                    const percent = Math.floor(Math.random() * 100);
                    const today = new Date();
                    const reference = Math.floor(Math.random() * 1000000000000000);

                    const prediction = predOutput[itm];
                    if (!predOutput.includes(prediction)) {
                        outputDiv.innerHTML += `<p>Prediction: Unknown</p>`;
                    } else {
                        outputDiv.innerHTML += `<p>Prediction: ${prediction} (${percent}%)</p>`;
                    }
                    outputDiv.innerHTML += `<p>Upload Reference ID: ${reference}</p>`;
                    outputDiv.innerHTML += `<p>Date: ${today.toDateString()}</p>`;
                };
                reader.readAsDataURL(imgInput.files[0]);
            }
        // }

        // function uploadImage() {

            const fileInput = document.getElementById('imageUpload');
            const file = fileInput.files[0];
            

            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const tableBody = document.getElementById('imageTableBody');
                    const newRow = document.createElement('tr');

                    const uploaderName = 'Jher'; // Replace with dynamic data if needed
                    const uploadReferenceID = Date.now().toString();

                    const commonName = 'Butterfly-Clippers'; // Replace with dynamic data if needed
                    const percent = Math.floor(Math.random() * 100);; // Replace with dynamic data if needed
                    const uploadImage = file.name;
                    const size = file.size;
                    const mimeType = file.type;
                    const lastModified = file.lastModified;
                    const content = 'Butterfly Class'; // Replace with dynamic data if needed
                    const date = new Date().toLocaleDateString();

                    newRow.innerHTML = `
                        <td>${uploaderName}</td>
                        <td>${uploadReferenceID}</td>
                        <td>${commonName}</td>
                        <td>${percent}</td>
                        <td>${uploadImage}</td>
                        <td>${size}</td>
                        <td>${mimeType}</td>
                        <td>${lastModified}</td>
                        <td>${content}</td>
                        <td>${date}</td>
                        <td><button onclick="deleteRow(this, ${uploadReferenceID})">Delete</button></td>
                    `;

                    tableBody.appendChild(newRow);
                };
                reader.readAsDataURL(file);
            }
        }
        function deleteRow(button, id) {
            // Remove the row from the table
            const row = button.parentNode.parentNode;
            row.parentNode.removeChild(row);

            // Call the server to delete the row from the database
            fetch(`/deleteButterflyImage/${id}`, {
                method: 'DELETE'
            }).then(response => {
                if (response.ok) {
                    console.log('Row deleted successfully');
                } else {
                    console.error('Failed to delete row');
                }
            });
        }
        document.getElementById('uploadForm').addEventListener('submit', uploadImage);

    </script>
</body>

</html>